<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProFormance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              slate: {
                850: '#151f32',
                900: '#0f172a',
                950: '#020617',
              },
              primary: {
                500: '#0ea5e9', // Blue from PDF
                600: '#0284c7',
              },
              accent: {
                500: '#f97316', // Orange from PDF
                600: '#ea580c',
              }
            },
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
            },
          },
        },
      }
    </script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
      }
      /* Custom scrollbar for tables */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #1e293b; 
      }
      ::-webkit-scrollbar-thumb {
        background: #475569; 
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #64748b; 
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "date-fns": "https://aistudiocdn.com/date-fns@^4.1.0",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.10.1",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="./index.tsx"></script>
    <p>
        同步狀態: <span id="last-sync-indicator">正在初始化...</span>
    </p>

    <script>
        
        /**
         * =========================================================
         * 前端 JavaScript 程式碼 (客戶端)
         * =========================================================
         */

        // --------------------------------------------------------
        // 步驟 1: 配置您的 Apps Script Web App URL
        // --------------------------------------------------------
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwh9gkeMqsJQ_yfYABTBQGb1OE3RqLMfnzxmpJnvf_E_HyH7_jHuMD6zGb1m3JUM-I/exec'; 
        const SYNC_INTERVAL_MS = 300000; // 5 分鐘

        // --------------------------------------------------------
        // 步驟 2: 執行數據拉取 (輪詢) 函數
        // --------------------------------------------------------
        function fetchSpreadsheetData() {
            console.log(`[SYNC] 正在向 Apps Script URL 發送 GET 請求...`);

            fetch(APPS_SCRIPT_URL, {
                method: 'GET', 
                headers: {
                    'Content-Type': 'application/json' 
                }
            })
            .then(response => {
                if (!response.ok) {
                    console.error(`[SYNC ERROR] HTTP 狀態碼錯誤: ${response.status}`);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); 
            })
            .then(data => {
                if (data.error) {
                    console.error('[SYNC ERROR] Apps Script 內部錯誤:', data.error);
                    return;
                }

                console.log('[SYNC SUCCESS] 數據拉取成功，共', data.data.length, '筆紀錄。');
                
                // 核心同步邏輯：使用拉取到的數據更新您的應用程式介面
                updateApplicationUI(data.data); 
                // 更新上次同步時間戳
                updateSyncIndicator(data.lastSync);
            })
            .catch(error => {
                console.error('[SYNC FAILED] 數據輪詢錯誤:', error);
            });
        }


        // --------------------------------------------------------
        // 步驟 3: 定時啟動輪詢與 UI 更新
        // --------------------------------------------------------
        // 由於程式碼已在底部，DOMContentLoaded 雖然不是絕對必需，但保持邏輯的穩定性
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[SYNC] 應用程式啟動，首次數據同步...');
            fetchSpreadsheetData();
            
            // 設定定時輪詢 (每 5 分鐘)
            setInterval(fetchSpreadsheetData, SYNC_INTERVAL_MS);
        });


        // =========================================================
        // 步驟 4: 實作 UI 更新函數 (您必須根據您的頁面結構來調整)
        // =========================================================

        /**
         * 負責將 Google Sheets 數據應用到應用程式介面的函數。
         * * @param {Array<Object>} sheetsData - 從 Apps Script 獲取到的 JSON 數據陣列。
         */
        function updateApplicationUI(sheetsData) {
            // !!! 在這裡填寫您的邏輯，例如更新圖表或列表 !!!
        }

        /**
         * 更新同步狀態指示器。
         * * @param {string} isoString - Apps Script 返回的 ISO 格式時間字串。
         */
        function updateSyncIndicator(isoString) {
            const timestamp = new Date(isoString);
            const timeString = timestamp.toLocaleTimeString(); 
            
            const indicatorElement = document.getElementById('last-sync-indicator'); 
            if (indicatorElement) {
                indicatorElement.textContent = `上次同步: ${timeString}`;
                indicatorElement.style.color = 'green';
            }
        }
    </script>
    </body>
</html>
  </body>
</html>
